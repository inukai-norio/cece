name: add release tag
on:
  pull_request:
    branches:
      - master
    types: [closed]

jobs:
  release:
    name: add tag
    runs-on: ubuntu-20.04
    if: github.event.pull_request.merged == true
    steps:
      - name: checkout
        uses: actions/checkout@v2
      - name: add release tag
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          REPO: ${{ github.repository }}
        run: |
           echo "{\"ref\":\"refs/tags/release-$(date +"%Y%m%d-%H%m")\",\"sha\":"$GITHUB_COMMIT"}" | \
           curl -s -X POST "https://api.github.com/repos/${REPO}/git/refs" \
            -H "Accept: application/vnd.github.v3+json" \
            -H "Authorization: token $GITHUB_TOKEN" \
            -d @-
