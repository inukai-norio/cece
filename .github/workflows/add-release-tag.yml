name: add release tag
on:
  pull_request:
    branches:
      - master
    types: [closed]

jobs:
  release:
    name: add tag
    runs-on: ubuntu-20.04
    if: github.event.pull_request.merged == true
    steps:
      - name: checkout
        uses: actions/checkout@v2
      - name: add release tag
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          TAG: ${{ github.event.pull_request.title }}
          REPO: ${{ github.repository }}
          COMMIT: ${{ github.sha }}
        run: |
          curl -s -X POST "https://api.github.com/repos/${REPO}/git/refs" \
            -H "Authorization: token $GITHUB_TOKEN" \
            -d @- << EOS \
            { \
              "ref": "refs/tags/${TAG}", \
              "sha": "${COMMIT}" \
            } \
            EOS
